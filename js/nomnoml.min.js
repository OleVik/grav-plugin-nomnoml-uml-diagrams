!function(t){"function"==typeof define&&define.amd?define(["lodash","dagre"],t):"object"==typeof module&&module.exports?module.exports=t(require("lodash"),require("dagre")):this.nomnoml=t(_,dagre)}(function(t,e){var n=n||{};n.Canvas=function(t,e){function n(e){var n=t;return{x:e.clientX-n.getBoundingClientRect().left-n.clientLeft+n.scrollLeft,y:e.clientY-n.getBoundingClientRect().top-n.clientTop+n.scrollTop}}function i(t,e,n,i){var r=void 0===i?1:i;return"rgba("+[Math.floor(t),Math.floor(e),Math.floor(n),r].join()+")"}function r(t,e,n){n=void 0===n?1:n,e=e||{x:0,y:0},o.beginPath(),o.moveTo(e.x+n*t[0].x,e.y+n*t[0].y);for(var i=1,r=t.length;i<r;i++)o.lineTo(e.x+n*t[i].x,e.y+n*t[i].y);return l}var o=t.getContext("2d"),s={x:0,y:0};e&&(t.addEventListener("mousedown",function(t){e.mousedown&&e.mousedown(n(t))}),t.addEventListener("mouseup",function(t){e.mouseup&&e.mouseup(n(t))}),t.addEventListener("mousemove",function(t){s=n(t),e.mousemove&&e.mousemove(n(t))}));var l={stroke:function(){return o.stroke(),l},fill:function(){return o.fill(),l},fillAndStroke:function(){return o.fill(),o.stroke(),l}};return{mousePos:function(){return s},width:function(){return t.width},height:function(){return t.height},ctx:o,background:function(e,n,r){o.fillStyle=i(e,n,r),o.fillRect(0,0,t.width,t.height)},clear:function(){o.clearRect(0,0,t.width,t.height)},circle:function(t,e,n){return o.beginPath(),2===arguments.length?o.arc(t.x,t.y,e,0,6.2832):o.arc(t,e,n,0,6.2832),l},ellipse:function(t,e,n,i,r){return void 0===i&&(i=0),void 0===r&&(r=6.2832),o.beginPath(),o.save(),o.translate(t.x,t.y),o.scale(1,n/e),o.arc(0,0,e/2,i,r),o.restore(),l},arc:function(t,e,n,i,r){return o.beginPath(),o.moveTo(t,e),o.arc(t,e,n,i,r),l},roundRect:function(t,e,n,i,r){return o.beginPath(),o.moveTo(t+r,e),o.arcTo(t+n,e,t+n,e+r,r),o.lineTo(t+n,e+i-r),o.arcTo(t+n,e+i,t+n-r,e+i,r),o.lineTo(t+r,e+i),o.arcTo(t,e+i,t,e+i-r,r),o.lineTo(t,e+r),o.arcTo(t,e,t+r,e,r),o.closePath(),l},rect:function(t,e,n,i){return o.beginPath(),o.moveTo(t,e),o.lineTo(t+n,e),o.lineTo(t+n,e+i),o.lineTo(t,e+i),o.closePath(),l},path:r,circuit:function(t,e,n){return r(t,e,n),o.closePath(),l},colorNorm:function(t,e,n,r){return i(255*t,255*e,255*n,r)},color255:i,colorObjHSL:function(t,e,n){function i(t){var i=Math.cos(6.283*t)/2+.5;return n*(1-e+e*i*i)}return{r:i(t),g:i(t-1/3),b:i(t+1/3)}},radialGradient:function(t,e,n,i,r){var s=o.createRadialGradient(t,e,n,t,e,i);for(var l in r)r.hasOwnProperty(l)&&s.addColorStop(l,r[l]);return s},font:function(t){o.font=t},fillStyle:function(t){o.fillStyle=t},strokeStyle:function(t){o.strokeStyle=t},textAlign:function(t){o.textAlign=t},lineCap:function(t){o.lineCap=t},lineJoin:function(t){o.lineJoin=t},lineWidth:function(t){o.lineWidth=t},arcTo:function(){return o.arcTo.apply(o,arguments)},beginPath:function(){return o.beginPath.apply(o,arguments)},fillText:function(){return o.fillText.apply(o,arguments)},lineTo:function(){return o.lineTo.apply(o,arguments)},measureText:function(){return o.measureText.apply(o,arguments)},moveTo:function(){return o.moveTo.apply(o,arguments)},restore:function(){return o.restore.apply(o,arguments)},save:function(){return o.save.apply(o,arguments)},scale:function(){return o.scale.apply(o,arguments)},setLineDash:function(){return o.setLineDash.apply(o,arguments)},stroke:function(){return o.stroke.apply(o,arguments)},translate:function(){return o.translate.apply(o,arguments)}}},(n=n||{}).sum=function(e,n){for(var i={undefined:t.identity,string:function(t){return t[n]},number:function(t){return t[n]},function:n}[typeof n],r=0,o=0,s=e.length;r<s;r++)o+=i(e[r]);return o},n.hasSubstring=function(t,e){return""===e||!!t&&-1!==t.indexOf(e)},n.format=function(e){var n=Array.prototype.slice.call(arguments,1);return t.flatten(t.zip(e.split("#"),n)).join("")},(n=n||{}).vector={dist:function(t,e){return n.vector.mag(n.vector.diff(t,e))},add:function(t,e){return{x:t.x+e.x,y:t.y+e.y}},diff:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},mult:function(t,e){return{x:e*t.x,y:e*t.y}},mag:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},normalize:function(t){return n.vector.mult(t,1/n.vector.mag(t))},rot:function(t){return{x:t.y,y:-t.x}}},(n=n||{}).Svg=function(t){function e(t,e,n){return e.style=e.style||"",{name:t,attr:e,content:n||void 0,stroke:function(){return this.attr.style+="stroke:"+s("stroke")+";fill:none;",this},fill:function(){return this.attr.style+="stroke:none; fill:"+s("fill")+";",this},fillAndStroke:function(){return this.attr.style+="stroke:"+s("stroke")+";fill:"+s("fill")+";",this}}}function n(t,e){return{x:t,y:e,stroke:null,fill:null,textAlign:null}}function i(t,e){return c.forEach(function(n){t+=n[e]}),t}function r(t){return Math.round(10*i(t,"x"))/10}function o(t){return Math.round(10*i(t,"y"))/10}function s(t){for(var e=c.length-1;e>=0;e--)if(c[e][t])return c[e][t]}function l(t){return t[t.length-1]}function a(t,e,n){return n=void 0===n?1:n,e=e||{x:0,y:0},h("path",{d:t.map(function(t,i){return(i?"L":"M")+r(e.x+n*t.x)+" "+o(e.y+n*t.y)}).join(" ")})}function h(t,n,i){var r=e(t,n,i);return u.push(r),r}var c=[{x:0,y:0,stroke:"none",fill:"none",textAlign:"left"}],u=[];return{width:function(){return u.width},height:function(){return u.height},background:function(){},clear:function(){},circle:function(t,n,i){var s=e("circle",2===arguments.length?{r:n,cx:r(t.x),cy:o(t.y)}:{r:i,cx:r(t),cy:o(n)});return u.push(s),s},ellipse:function(t,e,n){return h("ellipse",{cx:r(t.x),cy:o(t.y),rx:e/2,ry:n/2})},arc:function(t,e,n){return h("ellipse",{cx:r(t),cy:o(e),rx:n,ry:n})},roundRect:function(t,e,n,i,s){return h("rect",{x:r(t),y:o(e),rx:s,ry:s,height:i,width:n})},rect:function(t,e,n,i){return h("rect",{x:r(t),y:o(e),height:i,width:n})},path:a,circuit:function(t,e,n){var i=a(t,e,n);return i.attr.d+=" Z",i},font:function(t){l(c).font=t},strokeStyle:function(t){l(c).stroke=t},fillStyle:function(t){l(c).fill=t},arcTo:function(t,e,n,i){l(u).attr.d+="L"+r(t)+" "+o(e)+" L"+r(n)+" "+o(i)+" "},beginPath:function(){return h("path",{d:""})},fillText:function(t,e,n){return"center"===s("textAlign")&&(e-=this.measureText(t).width/2),h("text",{x:r(e),y:o(n)},t)},lineCap:function(e){t+=";stroke-linecap:"+e},lineJoin:function(e){t+=";stroke-linejoin:"+e},lineTo:function(t,e){l(u).attr.d+="L"+r(t)+" "+o(e)+" "},lineWidth:function(e){t+=";stroke-width:"+e},measureText:function(t){return{width:8.5*t.length}},moveTo:function(t,e){l(u).attr.d+="M"+r(t)+" "+o(e)+" "},restore:function(){c.pop()},save:function(){c.push(n(0,0))},scale:function(){},setLineDash:function(){},stroke:function(){l(u).stroke()},textAlign:function(t){l(c).textAlign=t},translate:function(t,e){l(c).x+=t,l(c).y+=e},serialize:function(n){function i(t){function e(e){return e+'="'+t[e]+'"'}return Object.keys(t).map(e).join(" ")}function r(t){return"<"+t.name+" "+i(t.attr)+">"+(t.content||"")+"</"+t.name+">"}var o=n||{};return o.version=o.version||"1.1",o.baseProfile=o.baseProfile||"full",o.width=o.width||"100%",o.height=o.height||"100%",o.xmlns=o.xmlns||"http://www.w3.org/2000/svg",o["xmlns:xlink"]=o["xmlns:xlink"]||"http://www.w3.org/1999/xlink",o["xmlns:ev"]=o["xmlns:ev"]||"http://www.w3.org/2001/xml-events",o.style=o.style||s("font")+";"+t,r(e("svg",o,u.map(r).join("\n")))}}};var i=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,compartment:4,EOF:5,slot:6,IDENT:7,class:8,association:9,SEP:10,parts:11,"|":12,"[":13,"]":14,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"IDENT",10:"SEP",12:"|",13:"[",14:"]"},productions_:[0,[3,2],[6,1],[6,1],[6,1],[4,1],[4,3],[11,1],[11,3],[11,2],[9,3],[8,3]],performAction:function(t,e,n,i,r,o,s){var l=o.length-1;switch(r){case 1:return o[l-1];case 2:this.$=o[l].trim().replace(/\\(\[|\]|\|)/g,"$1");break;case 3:case 4:this.$=o[l];break;case 5:this.$=[o[l]];break;case 6:this.$=o[l-2].concat(o[l]);break;case 7:this.$=[o[l]];break;case 8:this.$=o[l-2].concat([o[l]]);break;case 9:this.$=o[l-1].concat([[]]);break;case 10:var a=o[l-1].trim().replace(/\\(\[|\]|\|)/g,"$1").match("^(.*?)([<:o+]*-/?-*[:o+>]*)(.*)$");this.$={assoc:a[2],start:o[l-2],end:o[l],startLabel:a[1].trim(),endLabel:a[3].trim()};break;case 11:var h="CLASS",c=o[l-1][0][0],u=o[l-1][0][0].match("<([a-z]*)>(.*)");u&&(h=u[1].toUpperCase(),c=u[2].trim()),o[l-1][0][0]=c,this.$={type:h,id:c,parts:o[l-1]}}},table:[{3:1,4:2,6:3,7:[1,4],8:5,9:6,13:[1,7]},{1:[3]},{5:[1,8],10:[1,9]},{5:[2,5],10:[2,5],12:[2,5],14:[2,5]},{5:[2,2],10:[2,2],12:[2,2],14:[2,2]},{5:[2,3],7:[1,10],10:[2,3],12:[2,3],14:[2,3]},{5:[2,4],10:[2,4],12:[2,4],14:[2,4]},{4:12,6:3,7:[1,4],8:5,9:6,11:11,13:[1,7]},{1:[2,1]},{6:13,7:[1,4],8:5,9:6,13:[1,7]},{8:14,13:[1,7]},{12:[1,16],14:[1,15]},{10:[1,9],12:[2,7],14:[2,7]},{5:[2,6],10:[2,6],12:[2,6],14:[2,6]},{5:[2,10],10:[2,10],12:[2,10],14:[2,10]},{5:[2,11],7:[2,11],10:[2,11],12:[2,11],14:[2,11]},{4:17,6:3,7:[1,4],8:5,9:6,12:[2,9],13:[1,7],14:[2,9]},{10:[1,9],12:[2,8],14:[2,8]}],defaultActions:{8:[2,1]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,n=[0],i=[null],r=[],o=this.table,s="",l=0,a=0,h=0,c=1,u=r.slice.call(arguments,1);this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;r.push(d);var f=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError?this.parseError=this.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var y,p,g,m,x,v,k,b,w,S={};;){if(g=n[n.length-1],this.defaultActions[g]?m=this.defaultActions[g]:(null!==y&&void 0!==y||(y=function(){var t;return"number"!=typeof(t=e.lexer.lex()||c)&&(t=e.symbols_[t]||t),t}()),m=o[g]&&o[g][y]),void 0===m||!m.length||!m[0]){var _="";w=[];for(v in o[g])this.terminals_[v]&&v>2&&w.push("'"+this.terminals_[v]+"'");_=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[y]||y)+"'":"Parse error on line "+(l+1)+": Unexpected "+(y==c?"end of input":"'"+(this.terminals_[y]||y)+"'"),this.parseError(_,{text:this.lexer.match,token:this.terminals_[y]||y,line:this.lexer.yylineno,loc:d,expected:w})}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+y);switch(m[0]){case 1:n.push(y),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(m[1]),y=null,p?(y=p,p=null):(a=this.lexer.yyleng,s=this.lexer.yytext,l=this.lexer.yylineno,d=this.lexer.yylloc,h>0&&h--);break;case 2:if(k=this.productions_[m[1]][1],S.$=i[i.length-k],S._$={first_line:r[r.length-(k||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(k||1)].first_column,last_column:r[r.length-1].last_column},f&&(S._$.range=[r[r.length-(k||1)].range[0],r[r.length-1].range[1]]),void 0!==(x=this.performAction.apply(S,[s,a,l,this.yy,m[1],i,r].concat(u))))return x;k&&(n=n.slice(0,-1*k*2),i=i.slice(0,-1*k),r=r.slice(0,-1*k)),n.push(this.productions_[m[1]][0]),i.push(S.$),r.push(S._$),b=o[n[n.length-2]][n[n.length-1]],n.push(b);break;case 3:return!0}}return!0}},n=function(){return{EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(i=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in r)this[o]=r[o];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n,i;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length;o++)if((n=this._input.match(this.rules[r[o]]))&&(!e||n[0].length>e[0].length)){if(e=n,i=o,this.options.backtrack_lexer){if(!1!==(t=this.test_match(n,r[o])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[i]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,n,i){switch(n){case 0:return 12;case 1:return 7;case 2:return 13;case 3:return 14;case 4:return 10;case 5:return 5;case 6:return"INVALID"}},rules:[/^(?:\s*\|\s*)/,/^(?:(\\(\[|\]|\|)|[^\]\[|;\n])+)/,/^(?:\[)/,/^(?:\s*\])/,/^(?:[ ]*(;|\n)+[ ]*)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6],inclusive:!0}}}}();return e.lexer=n,t.prototype=e,e.Parser=t,new t}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=i,exports.Parser=i.Parser,exports.parse=function(){return i.parse.apply(i,arguments)},exports.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var e=require("fs").readFileSync(require("path").normalize(t[1]),"utf8");return exports.parser.parse(e)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1))),(r=r||{}).parse=function(e){function n(t){return"#"!==t[0]&&"//"!==t.substring(0,2)?t:""}var i=function(t){return"#"===t.text[0]},o=e.split("\n").map(function(t,e){return{text:t.trim(),index:e}}),s=t.filter(o,i),l=t.object(s.map(function(t){try{var e=t.text.substring(1).split(":");return[e[0].trim(),e[1].trim()]}catch(e){throw new Error("line "+(t.index+1))}})),a=t.map(t.pluck(o,"text"),n).join("\n").trim(),h=r.transformParseIntoSyntaxTree(r.intermediateParse(a));return h.directives=l,h},r.intermediateParse=function(t){return i.parse(t)},r.transformParseIntoSyntaxTree=function(e){function n(e){var n=[],s=[],l=[];t.each(e,function(t){"string"==typeof t&&n.push(t),t.assoc&&(s.push(t.start),s.push(t.end),l.push({id:o++,assoc:t.assoc,start:t.start.parts[0][0],end:t.end.parts[0][0],startLabel:t.startLabel,endLabel:t.endLabel})),t.parts&&s.push(t)});var a=t.map(s,i),h=t.map(t.groupBy(a,"name"),function(e){return t.max(e,function(t){return t.compartments.length})});return r.Compartment(n,h,l)}function i(e){if("string"==typeof e)return e;if(t.isArray(e))return n(e);if(e.parts){var i=t.map(e.parts,n);return r.Classifier(e.type,e.id,i)}}var o=0;return i(e)},(r=r||{}).styles={ABSTRACT:{center:1,bold:0,underline:0,italic:1,dashed:0,empty:0,hull:"auto",visual:"class"},ACTOR:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"actor"},CHOICE:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"rhomb"},CLASS:{center:1,bold:1,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"class"},DATABASE:{center:1,bold:1,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"database"},END:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:1,hull:"icon",visual:"end"},FRAME:{center:0,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"frame"},HIDDEN:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:1,hull:"empty",visual:"hidden"},INPUT:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"input"},INSTANCE:{center:1,bold:0,underline:1,italic:0,dashed:0,empty:0,hull:"auto",visual:"class"},LABEL:{center:0,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"none"},NOTE:{center:0,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"note"},PACKAGE:{center:0,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"package"},RECEIVER:{center:0,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"receiver"},REFERENCE:{center:1,bold:0,underline:0,italic:0,dashed:1,empty:0,hull:"auto",visual:"class"},SENDER:{center:0,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"sender"},START:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:1,hull:"icon",visual:"start"},STATE:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"roundrect"},USECASE:{center:1,bold:0,underline:0,italic:0,dashed:0,empty:0,hull:"auto",visual:"ellipse"}},r.visualizers={actor:function(t,e,n,i,r,o){var s=i/2,l=n+s/2,a={x:t.x,y:l-s};o.circle(a,s).fillAndStroke(),o.path([{x:t.x,y:l},{x:t.x,y:l+2*s}]).stroke(),o.path([{x:t.x-s,y:l+s},{x:t.x+s,y:l+s}]).stroke(),o.path([{x:t.x-s,y:l+s+i},{x:t.x,y:l+i},{x:t.x+s,y:l+s+i}]).stroke()},class:function(t,e,n,i,r,o){o.rect(e,n,t.width,t.height).fillAndStroke()},database:function(t,e,n,i,r,o){var s=n-i/2;o.rect(e,n,t.width,t.height).fill(),o.path([{x:e,y:s},{x:e,y:s+t.height}]).stroke(),o.path([{x:e+t.width,y:s},{x:e+t.width,y:s+t.height}]).stroke(),o.ellipse({x:t.x,y:s},t.width,1.5*i).fillAndStroke(),o.ellipse({x:t.x,y:s+t.height},t.width,1.5*i,0,3.1416).fillAndStroke()},ellipse:function(t,e,n,i,r,o){o.ellipse({x:t.x,y:t.y},t.width,t.height).fillAndStroke()},end:function(t,e,n,i,r,o){o.circle(t.x,n+t.height/2,t.height/3).fillAndStroke(),o.fillStyle(r.stroke),o.circle(t.x,n+t.height/2,t.height/3-i/2).fill()},frame:function(t,e,n,i,r,o){o.rect(e,n,t.width,t.height).fillAndStroke()},hidden:function(t,e,n,i,r,o){},input:function(t,e,n,i,r,o){o.circuit([{x:e+i,y:n},{x:e+t.width,y:n},{x:e+t.width-i,y:n+t.height},{x:e,y:n+t.height}]).fillAndStroke()},none:function(t,e,n,i,r,o){},note:function(t,e,n,i,r,o){o.circuit([{x:e,y:n},{x:e+t.width-i,y:n},{x:e+t.width,y:n+i},{x:e+t.width,y:n+t.height},{x:e,y:n+t.height},{x:e,y:n}]).fillAndStroke(),o.path([{x:e+t.width-i,y:n},{x:e+t.width-i,y:n+i},{x:e+t.width,y:n+i}]).stroke()},package:function(t,e,n,i,r,o){var s=t.compartments[0].height;o.rect(e,n+s,t.width,t.height-s).fillAndStroke();var l=o.measureText(t.name).width+2*i;o.circuit([{x:e,y:n+s},{x:e,y:n},{x:e+l,y:n},{x:e+l,y:n+s}]).fillAndStroke()},receiver:function(t,e,n,i,r,o){o.circuit([{x:e,y:n},{x:e+t.width+i,y:n},{x:e+t.width-i,y:n+t.height/2},{x:e+t.width+i,y:n+t.height},{x:e,y:n+t.height}]).fillAndStroke()},rhomb:function(t,e,n,i,r,o){o.circuit([{x:t.x,y:n-i},{x:e+t.width+i,y:t.y},{x:t.x,y:n+t.height+i},{x:e-i,y:t.y}]).fillAndStroke()},roundrect:function(t,e,n,i,r,o){var s=Math.min(2*i*r.leading,t.height/2);o.roundRect(e,n,t.width,t.height,s).fillAndStroke()},sender:function(t,e,n,i,r,o){o.circuit([{x:e,y:n},{x:e+t.width-i,y:n},{x:e+t.width+i,y:n+t.height/2},{x:e+t.width-i,y:n+t.height},{x:e,y:n+t.height}]).fillAndStroke()},start:function(t,e,n,i,r,o){o.fillStyle(r.stroke),o.circle(t.x,n+t.height/2,t.height/2.5).fill()}},(r=r||{}).Classifier=function(t,e,n){return{type:t,name:e,compartments:n}},r.Compartment=function(t,e,n){return{lines:t,nodes:e,relations:n}},r.layout=function(i,o,s){function l(t){return e.layout().rankSep(o.spacing).nodeSep(o.spacing).edgeSep(o.spacing).rankDir(o.direction).run(t)}function a(e,n){return e.length?(i.setFont(o,n),{width:Math.round(t.max(t.map(e,i.textWidth))+2*o.padding),height:Math.round(i.textHeight()*e.length+2*o.padding)}):{width:0,height:o.padding}}function h(n,i){function r(t){return{x:t.x,y:t.y}}var s=a(n.lines,i?"normal":"bold");if(n.width=s.width,n.height=s.height,n.nodes.length||n.relations.length){t.each(n.nodes,c);var h=new e.Digraph;t.each(n.nodes,function(t){h.addNode(t.name,{width:t.width,height:t.height})}),t.each(n.relations,function(t){h.addEdge(t.id,t.start,t.end)});var u=l(h),d=t.indexBy(n.relations,"id"),f=t.indexBy(n.nodes,"name");u.eachNode(function(t,e){f[t].x=e.x,f[t].y=e.y}),u.eachEdge(function(e,n,i,o){var s=f[n],l=f[i];d[e].path=t.map(t.flatten([s,o.points,l]),r)});var y=u.graph(),p=y.height?y.height+2*o.gutter:0,g=y.width?y.width+2*o.gutter:0;n.width=Math.max(s.width,g)+2*o.padding,n.height=s.height+p+o.padding}}function c(e){var i=o.styles[e.type]||r.styles.CLASS;return"icon"==i.hull?(e.width=2.5*o.fontSize,void(e.height=2.5*o.fontSize)):"empty"===i.hull?(e.width=0,void(e.height=0)):(t.each(e.compartments,h),e.width=t.max(t.pluck(e.compartments,"width")),e.height=n.sum(e.compartments,"height"),e.x=e.width/2,e.y=e.height/2,void t.each(e.compartments,function(t){t.width=e.width}))}return h(s),s},(r=r||{}).render=function(e,i,o,s){function l(e,n,r){y.save(),y.translate(f,f),y.fillStyle(i.stroke),t.each(e.lines,function(t,r){y.textAlign(n.center?"center":"left");var o=n.center?e.width/2-f:0,s=(.5+(r+.5)*i.leading)*i.fontSize;if(t&&y.fillText(t,o,s),n.underline){var l=y.measureText(t).width;s+=Math.round(.2*i.fontSize)+.5,y.path([{x:o-l/2,y:s},{x:o+l/2,y:s}]).stroke(),y.lineWidth=i.lineWidth}}),y.translate(i.gutter,i.gutter),t.each(e.relations,function(t){c(t,e)}),t.each(e.nodes,function(t){a(t,r)}),y.restore()}function a(e,n){var o=Math.round(e.x-e.width/2),a=Math.round(e.y-e.height/2),h=i.styles[e.type]||r.styles.CLASS;if(y.fillStyle(h.fill||i.fill[n]||t.last(i.fill)),h.dashed){var c=Math.max(4,2*i.lineWidth);y.setLineDash([c,c])}(r.visualizers[h.visual]||r.visualizers.class)(e,o,a,f,i,y),y.setLineDash([]);var u="actor"===h.visual?a+3*f/4:a;t.each(e.compartments,function(t,r){var a=r>0?{}:h;if(!a.empty&&(y.save(),y.translate(o,u),s(i,a.bold?"bold":"normal",a.italic),l(t,a,n+1),y.restore(),r+1!==e.compartments.length))if(u+=t.height,"frame"===h.visual&&0===r){var c=y.measureText(e.name).width+t.height/2+f;y.path([{x:o,y:u},{x:o+c-t.height/2,y:u},{x:o+c,y:u-t.height/2},{x:o+c,y:u-t.height}]).stroke()}else y.path([{x:o,y:u},{x:o+e.width,y:u}]).stroke()})}function h(e){if("rounded"===i.edges){var n=i.spacing*i.bendSize;y.beginPath(),y.moveTo(e[0].x,e[0].y);for(var r=1;r<e.length-1;r++)y.arcTo(e[r].x,e[r].y,e[r+1].x,e[r+1].y,n);y.lineTo(t.last(e).x,t.last(e).y),y.stroke()}else y.path(e).stroke()}function c(e,r){function o(t,e,n){">"===t||"<"===t?d(e,m,n):":>"===t||"<:"===t?d(e,g,n):"+"===t?d(e,m,n,x):"o"===t&&d(e,g,n,x)}var l=t.findWhere(r.nodes,{name:e.start}),a=t.findWhere(r.nodes,{name:e.end}),c=u(e.path[1],t.first(e.path),l),p=u(e.path[e.path.length-2],t.last(e.path),a),v=t.flatten([c,t.tail(t.initial(e.path)),p]),k=i.fontSize;y.fillStyle(i.stroke),s(i,"normal");var b=y.measureText(e.endLabel).width,w="LR"===i.direction?-f-b:f;if(e.startLabel&&y.fillText(e.startLabel,c.x+f,c.y+f+k),e.endLabel&&y.fillText(e.endLabel,p.x+w,p.y-f),"-/-"!==e.assoc)if(y.setLineDash&&n.hasSubstring(e.assoc,"--")){var S=Math.max(4,2*i.lineWidth);y.setLineDash([S,S]),h(v),y.setLineDash([])}else h(v);var _=e.assoc.split("-");o(t.last(_),v,p),o(t.first(_),v.reverse(),c)}function u(t,e,n){if(n.width||n.height){var r,o=n.width/2+i.edgeMargin,s=n.height/2+i.edgeMargin,l=p.diff(t,e);return r=l.x&&l.y?Math.min(Math.abs(o/l.x),Math.abs(s/l.y)):Math.abs(l.x?o/l.x:s/l.y),p.add(e,p.mult(l,r))}return e}function d(e,n,r,o){function s(t){return p.add(r,p.mult(h,t*l))}var l=(i.spacing-2*i.edgeMargin)*i.arrowSize/30,a=p.diff(e[e.length-2],t.last(e)),h=p.normalize(a),c=s(o?7:10),u=p.rot(h),d=o?s(14):n&&!i.fillArrows?s(5):c,f=[p.add(c,p.mult(u,4*l)),d,p.add(c,p.mult(u,-4*l)),r];y.fillStyle(n?i.stroke:i.fill[0]),y.circuit(f).fillAndStroke()}var f=i.padding,y=e,p=n.vector,g=!1,m=!0,x=!0;y.clear(),s(i,"bold"),y.save(),y.lineWidth(i.lineWidth),y.lineJoin("round"),y.lineCap("round"),y.strokeStyle(i.stroke),y.scale(i.zoom,i.zoom),function(){i.lineWidth%2==1&&y.translate(.5,.5)}(),l(o,{},0),y.restore()};var r=r||{};return function(){"use strict";function e(e){var n={};return t.each(e,function(e,i){"."==i[0]&&(n[i.substring(1).toUpperCase()]={center:t.contains(e,"center"),bold:t.contains(e,"bold"),underline:t.contains(e,"underline"),italic:t.contains(e,"italic"),dashed:t.contains(e,"dashed"),empty:t.contains(e,"empty"),fill:t.last(e.match("fill=([^ ]*)")),visual:t.last(e.match("visual=([^ ]*)"))||"class"})}),{arrowSize:+e.arrowSize||1,bendSize:+e.bendSize||.3,direction:{down:"TB",right:"LR"}[e.direction]||"TB",gutter:+e.gutter||5,edgeMargin:+e.edgeMargin||0,edges:{hard:"hard",rounded:"rounded"}[e.edges]||"rounded",fill:(e.fill||"#eee8d5;#fdf6e3;#eee8d5;#fdf6e3").split(";"),fillArrows:"true"===e.fillArrows,font:e.font||"Calibri",fontSize:+e.fontSize||12,leading:+e.leading||1.25,lineWidth:+e.lineWidth||3,padding:+e.padding||8,spacing:+e.spacing||40,stroke:e.stroke||"#33322E",title:e.title||"nomnoml",zoom:+e.zoom||1,styles:t.extend({},r.styles,n)}}function i(t,e,n){t.width=e.width*n,t.height=e.height*n}function o(t,e,i,r){var o="bold"===e?"bold":"";i&&(o="italic "+o);var s=n.format("# #pt #, #",o,t.fontSize,t.font,"Helvetica, sans-serif");r.font(s)}function s(t,n,s,l){var a=r.parse(t),h=e(a.directives),c={setFont:function(t,e,i){o(t,e,i,n)},textWidth:function(t){return n.measureText(t).width},textHeight:function(){return h.leading*h.fontSize}},u=r.layout(c,h,a);return i(s,u,h.zoom*l),h.zoom*=l,r.render(n,h,u,c.setFont),{config:h}}r.draw=function(t,e,i){return s(e,n.Canvas(t),t,i||1)},r.renderSvg=function(t){function i(t,e,i){var r="bold"===e?"bold":"";i&&(r="italic "+r);var o=n.format("font-weight:#; font-size:#pt; font-family:'#', #",r,t.fontSize,t.font,"Helvetica, sans-serif");l.font(o)}var o=r.parse(t),s=e(o.directives),l=n.Svg(""),a={setFont:function(t,e,n){i(t,e,n)},textWidth:function(t){return l.measureText(t).width},textHeight:function(){return s.leading*s.fontSize}},h=r.layout(a,s,o);return r.render(l,s,h,a.setFont),l.serialize({width:h.width,height:h.height})}}(),r});